{% extends 'ddm/project_admin/base.html' %}
{% load static %}

{% block page_title %}Project Overview{% endblock %}

{% block main_heading %}{{ object.name }}: Project Hub{% endblock %}

{% block main_body %}

<div class="ddm-admin-section">
  <div class="ddm-admin-section-header">Project Details</div>
  <div class="ddm-admin-section-body">
    <table class="table table-borderless table-sm">
      <tr>
        <td>Name:</td>
        <td>{{ object.name }}</td>
      </tr>
      <tr>
        <td>Slug:</td>
        <td>{{ object.slug }}</td>
      </tr>
      <tr>
        <td>Public Access:</td>
        <td><a href="{% url 'project-entry' object.slug %}" target="_blank">{{ request.scheme }}://{{ request.get_host }}{% url 'project-entry' object.slug %}</a></td>
      </tr>
      <tr>
        <td>Project Type:</td>
        <td>{% if object.super_secret %}Super Secret Project{% else %}Regular Project{% endif %}</td>
      </tr>
    </table>
    <p><a class="ddm-btn" href="{% url 'project-edit' object.pk %}">Edit Project Details</a></p>
  </div>
</div>


<div class="ddm-admin-section">
  <div class="ddm-admin-section-header">Project Configuration</div>
  <div class="ddm-admin-section-body">
    <div class="container">
      <div class="row d-flex align-items-stretch">
        <a class="card-link ddm-btn" href="{% url 'welcome-page-edit' object.pk %}">
          <div class="project-setup-card">
            <div><h3 class="text-center">Welcome Page</h3></div>
            <div><i class="bi bi-door-open fs-1"></i></div>
          </div>
        </a>
        <div class="project-setup-filler">
          <i class="bi bi-caret-right-fill fs-2"></i>
        </div>
        <a class="card-link ddm-btn" href="{% url 'blueprint-list' object.pk %}">
          <div class="project-setup-card">
            <h3 class="text-center">Data Donation</h3>
            <i class="bi bi-box2-heart fs-1"></i>
          </div>
        </a>
        <div class="project-setup-filler">
          <i class="bi bi-caret-right-fill fs-2"></i>
        </div>
        <a class="card-link ddm-btn" href="{% url 'questionnaire-overview' object.pk %}">
          <div class="project-setup-card">
            <h3 class="text-center">Questionnaire</h3>
            <i class="bi bi-pencil-square fs-1"></i>
          </div>
        </a>
        <div class="project-setup-filler">
          <i class="bi bi-caret-right-fill fs-2"></i>
        </div>
        <a class="card-link ddm-btn" href="{% url 'end-page-edit' object.pk %}">
          <div class="project-setup-card">
            <h3 class="text-center">End Page</h3>
            <i class="bi bi-door-closed fs-1"></i>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>


<div class="ddm-admin-section">
  <div class="ddm-admin-section-header">Data Center</div>
  <div class="ddm-admin-section-body">
    <h4>Statistics</h4>
    <div class="row fw-bold text-center bg-white">
      {% with stats=object.get_statistics %}
      <div class="col">
        <p class="mb-0">n Started</p>
        <p class="fs-3 mb-0">{{ stats.n_started }}</p>
      </div>
      <div class="col">
        <p class="mb-0">n Completed</p>
        <p class="fs-3 mb-0">{{ stats.n_completed }}</p>
      </div>
      <div class="col">
        <p class="mb-0">Completion Rate</p>
        <p class="fs-3 mb-0">{{ stats.completion_rate|floatformat:2 }}</p>
      </div>
      <div class="col">
        <p class="mb-0">n Donations</p>
        <p class="fs-3 mb-0">{{ stats.n_donations }}</p>
      </div>
      <div class="col">
        <p class="mb-0">n Errors</p>
        <p class="fs-3 mb-0">{{ stats.n_errors }}</p>
      </div>
      <div class="col">
        <p class="mb-0">Avrg. to complete</p>
        <p class="fs-3 mb-0">{{ stats.average_time }}</p>
        <p class="fs-6 mb-0">(H:m:s)</p>
      </div>
      {% endwith %}
    </div>
    <h4 class="mt-3">Download Section</h4>
    <div>
      <p><button onclick="downloadData('{% url "ddm-download-api" object.pk %}', 'project_{{ object.pk }}_data')" class="ddm-btn">Download Data as JSON</button></p>
    </div>
    <h4>Exception Log</h4>
    <div>
      <p><a href="{% url 'project-exceptions' object.pk %}">Show registered exceptions</a></p>
    </div>
  </div>
</div>


<div class="ddm-admin-section">
  <div class="ddm-admin-section-header">Danger Zone</div>
  <div class="ddm-admin-section-body">
    <h4>Reset Project Data</h4>
    <div>
      <p><button class="ddm-btn ddm-btn-red" data-bs-toggle="modal" data-bs-target="#delete-data-confirm">Reset Project Data</button></p>
    </div>
    <h4>Delete Project</h4>
    <div>
      <p><button class="ddm-btn ddm-btn-red" href="{% url 'project-delete' object.pk %}">Delete Project</button></p>
    </div>
  </div>
</div>


<div class="modal" id="delete-data-confirm" data-bs-backdrop="static" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <h4>Careful!</h4>
        <p>You are about to delete all collected data related to your project.</p>
        This includes:
        <ul>
          <li>All data donations</li>
          <li>All questionnaire responses</li>
          <li>All participation statistics</li>
        </ul>
        <p>We strongly recommend downloading and storing a copy of your data before you continue with this procedure.</p>
        <p>Are you sure you want to delete all data related to this project?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="ddm-btn" data-bs-dismiss="modal">Cancel</button>
        <button id="delete-data-button" type="button" class="ddm-btn ddm-btn-red" data-bs-dismiss="modal" onclick="deleteData('{% url "ddm-download-api" object.pk %}', '{{csrf_token}}')">Yes, delete all data</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}


{% block breadcrumbs %}
<a href="{% url 'project-list' %}">Projects</a> /
"{{ object.name|truncatechars:15 }}" Project
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'ddm/js/download-data.js' %}"></script>
<script src="{% static 'ddm/js/delete-data.js' %}"></script>
{% endblock %}
