(function(){"use strict";var e={8304:function(e,t,n){var a=n(9963),o=n(6252),s=n(3577);const r={class:"row"},i={class:"col"};function l(e,t,n,a,l,c){const d=(0,o.up)("FileUploader");return(0,o.wg)(),(0,o.iD)(o.HY,null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.ul_config,((e,t)=>((0,o.wg)(),(0,o.j4)(d,{key:t,comp_id:t,zipped:"zip"===e.ul_type,name:e.name,blueprints:e.blueprints,instructions:e.instructions,onChangedData:c.updatePostData},null,8,["comp_id","zipped","name","blueprints","instructions","onChangedData"])))),128)),(0,o._)("div",r,[(0,o._)("div",i,[(0,o._)("button",{class:"flow-btn",type:"button",onClick:t[0]||(t[0]=(...e)=>c.zipData&&c.zipData(...e))},(0,s.zw)(e.$t("next-btn-label"))+"  ›",1)])])],64)}const c=e=>((0,o.dD)("data-v-f2f1b1dc"),e=e(),(0,o.Cn)(),e),d={class:"mb-5"},u={class:"float-left bg-dark text-white pt-2 ps-2 pb-1 rounded-top"},p={class:"col-sm"},_=["id"],f={class:"accordion-item"},b=["id"],m=["data-bs-target","aria-controls"],h=["id","data-bs-parent"],g={class:"accordion-body"},w={key:1},x={class:"row"},v={class:"col"},y={class:"accordion-header mb-0"},z={class:"select-file-btn"},D=["name"],k=c((()=>(0,o._)("span",{class:"spinner-border float-right me-3",role:"status"},[(0,o._)("span",{class:"sr-only"})],-1))),C={class:"accordion-body border"},S={class:"pb-2"},O=(0,o.Uk)(),$=["set","id"],U={class:"col"},T=["href","aria-controls"],E=["for"],P=["id","onUpdate:modelValue"],j=["set","id","aria-labelledby"],F={class:"modal-dialog fb-modal"},A={class:"modal-content"},H={class:"modal-header"},I={class:"modal-title"},N={class:"modal-body"},Y={class:"modal-body-intro"},K={class:"modal-body-data"},J=["id"],V={class:"modal-footer"},Z=["for"],M=["id","onUpdate:modelValue"],q=c((()=>(0,o._)("div",null,[(0,o._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"OK")],-1)));function B(e,t,n,r,i,l){const c=(0,o.up)("DonationInstructions");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",d,[(0,o._)("div",u,[(0,o._)("div",p,[(0,o._)("h4",null,"Upload "+(0,s.zw)(n.name),1)])]),(0,o._)("div",{class:"accordion",id:"ul-acc-"+n.comp_id},[(0,o._)("div",f,[(0,o._)("h3",{class:"accordion-header",id:"acc-instr-head-"+n.comp_id},[(0,o._)("button",{class:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#acc-instr-body-"+n.comp_id,"aria-expanded":"true","aria-controls":"acc-instr-body-"+n.comp_id},[(0,o._)("b",null,(0,s.zw)(e.$t("instructions")),1)],8,m)],8,b),(0,o._)("div",{id:"acc-instr-body-"+n.comp_id,class:"accordion-collapse collapse show","aria-labelledby":"headingOne","data-bs-parent":"#ul-acc-"+n.comp_id},[(0,o._)("div",g,[n.instructions.length>0?((0,o.wg)(),(0,o.j4)(c,{key:0,instructions:n.instructions,comp_id:n.comp_id},null,8,["instructions","comp_id"])):((0,o.wg)(),(0,o.iD)("div",w,(0,s.zw)(e.$t("no-instructions-defined"))+".",1))])],8,h)])],8,_),(0,o._)("div",{class:(0,s.C_)(["accordion-body border",{"ul-success":i.extraction_complete}])},[(0,o._)("div",x,[(0,o._)("div",v,[(0,o._)("p",y,[(0,o._)("span",{class:(0,s.C_)({"d-none":!i.upload_enabled&i.extraction_complete|i.processing|i.extraction_complete})},[(0,o._)("b",null,(0,s.zw)(e.$t("upload-file"))+":",1)],2),(0,o._)("span",{class:(0,s.C_)({"d-none":!i.upload_enabled&i.extraction_complete|i.processing|!i.extraction_complete})},[(0,o._)("b",null,(0,s.zw)(e.$t("upload-different-file")),1)],2),(0,o._)("span",{class:(0,s.C_)(["fs-6 text-success",{"d-none":i.upload_enabled&i.extraction_complete|i.processing|!i.extraction_complete}])},[(0,o._)("b",null,(0,s.zw)(e.$t("upload-success")),1)],2),(0,o._)("span",{class:(0,s.C_)({"d-none":i.upload_enabled&i.extraction_complete|i.processing|!i.extraction_complete})},[(0,o._)("a",{onClick:t[0]||(t[0]=e=>i.upload_enabled=!i.upload_enabled),class:"upload-other"},(0,s.zw)(e.$t("choose-different-file")),1)],2),(0,o._)("span",{class:(0,s.C_)({"d-none":!i.upload_enabled|i.processing})},[(0,o._)("label",z,[(0,o._)("input",{name:"ul-"+n.comp_id,type:"file",onChange:t[1]||(t[1]=(...e)=>l.processFile&&l.processFile(...e)),class:"d-none"},null,40,D),(0,o.Uk)(" "+(0,s.zw)(e.$t("choose-file")),1)])],2)]),(0,o._)("div",{class:(0,s.C_)(["clearfix",{"d-none":!i.processing}])},[(0,o._)("p",null,[k,(0,o.Uk)(" "+(0,s.zw)(e.$t("file-is-being-uploaded"))+"... ",1)])],2)])])],2),(0,o._)("div",C,[(0,o._)("div",S,[(0,o._)("b",null,(0,s.zw)(e.$t("extracted-files"))+":",1),O,(0,o._)("span",{class:(0,s.C_)({"d-none":i.extraction_complete})},(0,s.zw)(e.$t("no-data-extracted"))+".",3)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.blueprints,(n=>((0,o.wg)(),(0,o.iD)("div",{key:n,set:e.bp_index=n.id.toString(),id:"bp-entry-"+e.bp_index,class:"ul-status row border-top pt-2 pb-2"},[(0,o._)("div",U,[(0,o._)("p",null,[(0,o.Uk)((0,s.zw)(e.$t("file"))+" "+(0,s.zw)(n.id)+": ",1),(0,o._)("span",{class:(0,s.C_)({"d-none":i.extraction_complete})},(0,s.zw)(e.$t("not-yet-uploaded")),3),(0,o._)("span",{class:(0,s.C_)({"d-none":!i.extraction_complete})},(0,s.zw)(e.$t("upload-success-short")),3)])]),(0,o._)("div",{class:(0,s.C_)(["col",{"d-none":!i.extraction_complete}])},[(0,o._)("a",{class:"text-orange text-decoration-none",role:"button","data-bs-toggle":"modal",href:"#bp-fb-"+e.bp_index,"aria-controls":"bp-fb-"+e.bp_index},(0,s.zw)(e.$t("show-extracted-data"))+" ↗",9,T)],2),(0,o._)("div",{class:(0,s.C_)(["col-6 text-end",{"d-none":!i.extraction_complete}])},[(0,o._)("p",null,[(0,o._)("label",{class:"form-check-label",for:"ul-consent-"+e.bp_index},[(0,o.wy)((0,o._)("input",{class:"form-check-input consent-checkbox",id:"ul-consent-"+e.bp_index,type:"checkbox",onChange:t[2]||(t[2]=(...e)=>l.emitToParent&&l.emitToParent(...e)),"onUpdate:modelValue":e=>i.post_data[n.id.toString()].consent=e},null,40,P),[[a.e8,i.post_data[n.id.toString()].consent]]),(0,o.Uk)("  "+(0,s.zw)(e.$t("submit-agree")),1)],8,E)])],2)],8,$)))),128))])]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.blueprints,(n=>((0,o.wg)(),(0,o.iD)("div",{key:n,set:e.bp_index=n.id.toString(),class:"modal fade",id:"bp-fb-"+e.bp_index,tabdindex:"-1","aria-labelledby":"bp-fb-"+e.bp_index,"aria-hidden":"true"},[(0,o._)("div",F,[(0,o._)("div",A,[(0,o._)("div",H,[(0,o._)("h5",I,(0,s.zw)(e.$t("extracted-data")),1)]),(0,o._)("div",N,[(0,o._)("div",Y,[(0,o._)("p",null,(0,s.zw)(e.$t("extracted-data-intro"))+":",1)]),(0,o._)("div",K,[(0,o._)("table",{id:"ul-result-"+e.bp_index,class:"table table-striped fs-6 text"},[(0,o._)("tr",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.f_extract,(e=>((0,o.wg)(),(0,o.iD)("th",{key:e},(0,s.zw)(e),1)))),128))]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.post_data[n.id.toString()].extracted_data,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e,(e=>((0,o.wg)(),(0,o.iD)("td",{key:e},(0,s.zw)(e),1)))),128))])))),128))],8,J)])]),(0,o._)("div",V,[(0,o._)("div",null,[(0,o._)("label",{class:"form-check-label fs-5 me-4",for:"ul-consent-"+e.bp_index},[(0,o.wy)((0,o._)("input",{class:"form-check-input consent-checkbox mt-1",id:"ul-consent--"+e.bp_index,type:"checkbox",onChange:t[3]||(t[3]=(...e)=>l.emitToParent&&l.emitToParent(...e)),"onUpdate:modelValue":e=>i.post_data[n.id.toString()].consent=e},null,40,M),[[a.e8,i.post_data[n.id.toString()].consent]]),(0,o.Uk)("  "+(0,s.zw)(e.$t("submit-agree")),1)],8,Z)]),q])])])],8,j)))),128))],64)}n(6699);var L=n(5733),R=n.n(L);const G=e=>((0,o.dD)("data-v-052c08e8"),e=e(),(0,o.Cn)(),e),Q=["id"],W={class:"carousel-indicators"},X=["data-bs-target","data-bs-slide-to","aria-label","aria-current"],ee={class:"carousel-inner"},te=["innerHTML"],ne=["data-bs-target"],ae=G((()=>(0,o._)("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1))),oe=G((()=>(0,o._)("span",{class:"visually-hidden"},"Previous",-1))),se=[ae,oe],re=["data-bs-target"],ie=G((()=>(0,o._)("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1))),le=G((()=>(0,o._)("span",{class:"visually-hidden"},"Next",-1))),ce=[ie,le];function de(e,t,n,a,r,i){return(0,o.wg)(),(0,o.iD)("div",{id:"carousel-"+n.comp_id,class:"carousel carousel-dark slide","data-bs-interval":"false","data-bs-ride":"carousel"},[(0,o._)("div",W,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.instructions,((e,t)=>((0,o.wg)(),(0,o.iD)("button",{key:t,type:"button","data-bs-target":"#carousel-"+n.comp_id,"data-bs-slide-to":t,"aria-label":"Step "+t,class:(0,s.C_)({active:0===t}),"aria-current":0===t},null,10,X)))),128))]),(0,o._)("div",ee,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.instructions,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,class:(0,s.C_)(["carousel-item",{active:0===t}]),innerHTML:e.text},null,10,te)))),128))]),(0,o._)("button",{class:"carousel-control-prev",type:"button","data-bs-target":"#carousel-"+n.comp_id,"data-bs-slide":"prev"},se,8,ne),(0,o._)("button",{class:"carousel-control-next",type:"button","data-bs-target":"#carousel-"+n.comp_id,"data-bs-slide":"next"},ce,8,re)],8,Q)}var ue={name:"DonationInstructions",props:{instructions:Array,comp_id:Number},data(){return{}},methods:{}},pe=n(3744);const _e=(0,pe.Z)(ue,[["render",de],["__scopeId","data-v-052c08e8"]]);var fe=_e,be={name:"ProcessFile",components:{DonationInstructions:fe},props:{zipped:Boolean,blueprints:Array,comp_id:Number,name:String,instructions:Array},emits:["changedData"],data(){return{row_data:[],extraction_complete:!1,post_data:{},processing:!1,upload_enabled:!0}},created(){this.blueprints.forEach((e=>{let t=e.id,n={filename:null,consent:!1,extracted_data:[],status:{ul_complete:!1,errors:[]}};this.post_data[t.toString()]=n})),this.emitToParent()},methods:{processFile(e){let t=this;t.processing=!0;const n=e.target.files;if(t.zipped&&1===n.length){let e=new(R());e.loadAsync(n[0]).then((function(e){t.blueprints.forEach((n=>{let a=new RegExp(n.regex_path);e.file(a).forEach((e=>{e.async("string").then((e=>{t.processContent(e,n)}))}))}))})).catch({})}else if(!this.zipped&&1===n.length){let e=t.blueprints[0];t.processSingleFile(n[0],e)}t.emitToParent(),setTimeout((()=>{t.extraction_complete=!0,t.processing=!1,t.upload_enabled=!1}),2e3)},processContent(e,t){let n=this,a=n.post_data[t.id.toString()],o=[];if("json"===t.format){let n=JSON.parse(e);n.forEach((e=>{if(t.f_expected.every((t=>Object.keys(e).includes(t)))){for(let n in e)t.f_extract.indexOf(n)<0&&delete e[n];o.push(e)}else a.status.errors.push("some error")})),a.extracted_data=o}0==a.status.errors.length&&(a.status.ul_complete=!0)},processSingleFile(e,t){let n=this,a=new FileReader;a.onload=function(e){let a=e.target.result;n.processContent(a,t)},a.readAsText(e)},emitToParent(){let e=JSON.parse(JSON.stringify(this.post_data));Object.keys(e).forEach((t=>{e[t].consent||(e[t].extracted_data=[])})),this.$emit("changedData",e)}}};function me(e){e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{instructions:e=>{const{normalize:t}=e;return t(["Instructions"])},"no-instructions-defined":e=>{const{normalize:t}=e;return t(["No instructions defined"])},"upload-file":e=>{const{normalize:t}=e;return t(["Upload File"])},"upload-different-file":e=>{const{normalize:t}=e;return t(["Upload a different file"])},"upload-success":e=>{const{normalize:t}=e;return t(["Upload was successful"])},"choose-different-file":e=>{const{normalize:t}=e;return t(["select a different file"])},"choose-file":e=>{const{normalize:t}=e;return t(["Select file"])},"file-is-being-uploaded":e=>{const{normalize:t}=e;return t(["file is being uploaded"])},"extracted-files":e=>{const{normalize:t}=e;return t(["Extracted files"])},"no-data-extracted":e=>{const{normalize:t}=e;return t(["No data extracted yet"])},"not-yet-uploaded":e=>{const{normalize:t}=e;return t(["Not yet uploaded"])},"upload-success-short":e=>{const{normalize:t}=e;return t(["Upload successful"])},"show-extracted-data":e=>{const{normalize:t}=e;return t(["Show extracted data"])},"submit-agree":e=>{const{normalize:t}=e;return t(["I agree to submit this data"])},"extracted-data":e=>{const{normalize:t}=e;return t(["Extracted Data"])},"extracted-data-intro":e=>{const{normalize:t}=e;return t(["The following data has been extracted and will be transmitted to the researchers with your consent"])},file:e=>{const{normalize:t}=e;return t(["file"])}},de:{instructions:e=>{const{normalize:t}=e;return t(["Instruktionen"])},"no-instructions-defined":e=>{const{normalize:t}=e;return t(["Es wurden keine Instruktionen definiert"])},"upload-file":e=>{const{normalize:t}=e;return t(["Datei hochladen"])},"upload-different-file":e=>{const{normalize:t}=e;return t(["Andere Datei hochladen"])},"upload-success":e=>{const{normalize:t}=e;return t(["Upload erfolgreich abgeschlossen"])},"choose-different-file":e=>{const{normalize:t}=e;return t(["eine andere Datei auswählen"])},"choose-file":e=>{const{normalize:t}=e;return t(["Datei auswählen"])},"file-is-being-uploaded":e=>{const{normalize:t}=e;return t(["Datei wird hochgeladen"])},"extracted-files":e=>{const{normalize:t}=e;return t(["Ausgelesene Dateien"])},"no-data-extracted":e=>{const{normalize:t}=e;return t(["Es wurden noch keine Daten ausgelesen"])},"not-yet-uploaded":e=>{const{normalize:t}=e;return t(["Noch nicht hochgeladen"])},"upload-success-short":e=>{const{normalize:t}=e;return t(["Upload erfolgreich"])},"show-extracted-data":e=>{const{normalize:t}=e;return t(["Ausgelesene Daten ansehen"])},"submit-agree":e=>{const{normalize:t}=e;return t(["Ich bin damit einverstanden, diese Daten zu übermitteln"])},"extracted-data":e=>{const{normalize:t}=e;return t(["Ausgelesene Daten"])},"extracted-data-intro":e=>{const{normalize:t}=e;return t(["Die folgenden Daten wurden ausgelesen und werden bei Ihrer Zustimmung an die Forschenden übermittelt"])},file:e=>{const{normalize:t}=e;return t(["Datei"])}}}})}"function"===typeof me&&me(be);const he=(0,pe.Z)(be,[["render",B],["__scopeId","data-v-f2f1b1dc"]]);var ge=he,we={name:"UApp",components:{FileUploader:ge},props:{uploadconfig:String,actionurl:String,language:String},data(){return this.$i18n.locale=this.language,{ul_config:JSON.parse(this.uploadconfig),post_data:{},locale:"en"}},watch:{locale(e){this.$i18n.locale=e}},methods:{updatePostData(e){Object.keys(e).forEach((t=>{this.post_data[t]=e[t]}))},zipData(){let e=document.querySelectorAll("input[type=file]");e.forEach((e=>{e.disabled=!0}));let t=new FormData(document.getElementById("uploader-form")),n=new(R());n.file("ul_data.json",JSON.stringify(this.post_data)).generateAsync({type:"blob"}).then((e=>{t.append("post_data",e),fetch(this.actionurl,{method:"POST",body:t}).then((e=>{console.log(e),e.redirected&&(window.location.href=e.url)})).catch((e=>{console.info(e)}))}))}}};function xe(e){e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{"next-btn-label":e=>{const{normalize:t}=e;return t(["Submit Data"])}},de:{"next-btn-label":e=>{const{normalize:t}=e;return t(["Daten übermitteln"])}}}})}"function"===typeof xe&&xe(we);const ve=(0,pe.Z)(we,[["render",l]]);var ye=ve,ze=n(2474);const De=new ze.o({}),ke="#uapp",Ce=document.querySelector(ke),Se=(0,a.ri)(ye,{...Ce.dataset});Se.use(De),Se.mount(ke)}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,s){if(!a){var r=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],s=e[d][2];for(var i=!0,l=0;l<a.length;l++)(!1&s||r>=s)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(i=!1,s<r&&(r=s));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={93:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,s,r=a[0],i=a[1],l=a[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)var d=l(n)}for(t&&t(a);c<r.length;c++)s=r[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self["webpackChunkvue_frontend"]=self["webpackChunkvue_frontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(8304)}));a=n.O(a)})();